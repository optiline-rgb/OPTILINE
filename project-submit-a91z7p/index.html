<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project Brief | OPTILINE Agency</title>
    
    <meta name="description" content="Thank you. Please complete your project brief to begin.">
    <meta name="robots" content="noindex, nofollow">
    
    <link rel="icon" type="image/webp" href="https://i.ibb.co/jvhxGcxT/FAV-3.webp">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700;900&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="/assets/css/style.css">
    
    <style>
        .project-brief-form {
            max-width: 800px;
            margin: 0 auto;
            padding: 3rem 2rem;
            background: var(--card-bg);
            border: 1px solid var(--card-border-color);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            text-align: left;
        }
        .project-brief-form .form-group { margin-bottom: 1.5rem; }
        .project-brief-form .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--text-gray);
            font-weight: 500;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .project-brief-form .form-group input,
        .project-brief-form .form-group textarea {
            width: 100%;
            padding: 15px;
            background: var(--secondary-dark);
            border: 1px solid var(--card-border-color);
            color: var(--text-light);
            border-radius: 8px;
            transition: border-color var(--transition-fast), box-shadow var(--transition-fast);
            font-family: var(--font-main);
            font-size: 1rem;
        }
        .project-brief-form .form-group input:focus,
        .project-brief-form .form-group textarea:focus {
            outline: none;
            border-color: var(--accent-purple);
            box-shadow: 0 0 0 3px rgba(164, 94, 255, 0.7);
        }
        .project-brief-form .form-group textarea {
            resize: vertical;
            min-height: 120px;
        }
    </style>
</head>
<body>
    <div class="custom-cursor"></div>

    <header class="main-header" id="header">
        <a href="/home/" class="logo"><img src="https://i.ibb.co/ZpvD9mSj/OPTILINE-LOGO.webp" alt="OPTILINE Logo"></a>
        <nav>
            <ul class="nav-links">
                <li><a href="/home/">Home</a></li>
                <li><a href="/services/">Services</a></li>
                <li><a href="/portfolio/">Portfolio</a></li>
                <li><a href="/pricing/">Pricing</a></li>
                <li><a href="/contact/">Contact</a></li>
            </ul>
        </nav>
        <div class="hamburger"><div class="bar1"></div><div class="bar2"></div><div class="bar3"></div></div>
    </header>

    <main>
        <section class="page-hero">
            <div class="container anim-group">
                <h1 class="subtle-glow">Payment Confirmed.</h1>
                <p>Thank you for trusting OPTILINE. Please complete the final step to begin your project.</p>
            </div>
        </section>

        <section class="section" id="project-brief-section">
            <div class="container">
                <form class="project-brief-form anim-group" name="projectBrief" id="projectBriefForm">
                    
                    <div class="section-title" style="margin-bottom: 2rem; text-align: left;">
                        <h2 style="font-size: 2.5rem; margin: 0;">Project Brief</h2>
                    </div>

                    <input type="hidden" id="marketerField" name="marketer">
                    <input type="hidden" id="paypalTxField" name="paypal_tx_id"> <div class="form-group">
                        <label for="payerEmail">Your PayPal Email *</label>
                        <input type="email" id="payerEmail" name="payerEmail" required placeholder="Email you used for payment...">
                    </div>
                    <div class="form-group">
                        <label for="projectName">Project / Company Name *</label>
                        <input type="text" id="projectName" name="projectName" required placeholder="What is your brand name?">
                    </div>
                    <div class="form-group">
                        <label for="goals">What is the main goal of this project? *</label>
                        <textarea id="goals" name="goals" placeholder="e.g., Launch a new brand, redesign our website, create a video ad..." required></textarea>
                    </div>
                    <div class="form-group">
                        <label for="audience">Who is your target audience? *</label>
                        <textarea id="audience" name="audience" placeholder="e.g., Age, interests, location, etc." required></textarea>
                    </div>
                    <div class="form-group">
                        <label for="competitors">Who are your main competitors?</label>
                        <input type="text" id="competitors" name="competitors" placeholder="e.g., competitor.com, anotherbrand.com">
                    </div>
                    <div class="form-group">
                        <label for="links">Design Inspiration</label>
                        <textarea id="links" name="links" placeholder="Links to websites, brands, or styles you like..."></textarea>
                    </div>

                    <div style="text-align: center; margin-top: 2rem;">
                        <button type="submit" class="cta-button" id="submitBriefButton">Submit Project & Begin</button>
                    </div>
                </form>

                <div id="successMessage" style="display: none; text-align: center; padding: 4rem 0;" class="anim-group">
                    <h2 class="subtle-glow" style="font-size: 2.5rem;">Submission Received!</h2>
                    <p style="font-size: 1.2rem; max-width: 600px; margin: 1rem auto; color: var(--text-gray);">Thank you. Our team has your project details and will be in touch shortly to confirm the next steps.</p>
                </div>
            </div>
        </section>
    </main>
    
    <footer class="main-footer">
        <div class="container footer-content">
            <div class="footer-about">
                <a href="/home/" class="logo"><img src="https://i.ibb.co/ZpvD9mSj/OPTILINE-LOGO.webp" loading="lazy" alt="OPTILINE Logo"></a>
                <p>OPTILINE is a creative agency dedicated to building the brands of tomorrow. We partner with visionaries to create work that matters.</p>
            </div>
            <div class="footer-links">
                <h4>Explore</h4><ul><li><a href="/services/">Services</a></li><li><a href="/portfolio/">Portfolio</a></li><li><a href="/pricing/">Pricing</a></li></ul>
            </div>
            <div class="footer-links">
                <h4>Support</h4><ul><li><a href="/contact/">Contact Us</a></li><li><a href="/home/#process">Our Process</a></li><li><a href="/careers/">Careers</a></li></ul>
            </div>
        </div>
        <div class="copyright"><p>© 2025 OPTILINE. A New Era of Creativity.</p></div>
    </footer>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>
    <script src="/assets/js/main.js"></script>
    
    <script>
      // Function to get the marketer from cookie (primary) or localStorage (fallback)
      function getStoredMarketer() {
        try {
          const cookieValue = document.cookie
            .split('; ')
            .find(row => row.startsWith('optiline_ref='))
            ?.split('=')[1];
          
          if (cookieValue) {
            return decodeURIComponent(cookieValue);
          }
          return localStorage.getItem('optiline_marketer_ref');
        } catch(e) {
          return null;
        }
      }

      // 1. Populate ALL hidden fields on page load
      (function populateHiddenFields() {
        try {
          // 1a. Get Marketer from Cookie
          const marketerName = getStoredMarketer() || 'Direct';
          const marketerField = document.getElementById('marketerField');
          if (marketerField) {
            marketerField.value = marketerName;
          }

          // 1b. Get PayPal TX ID from URL
          const urlParams = new URLSearchParams(window.location.search);
          const txId = urlParams.get('tx'); // 'tx' is the parameter PayPal adds
          const paypalTxField = document.getElementById('paypalTxField');
          if (paypalTxField && txId) {
            paypalTxField.value = txId;
          }

        } catch (e) {
          console.warn('OPTILINE: Error populating hidden fields.', e);
        }
      })();


      // 2. Add the submit listener for the form
      window.addEventListener('load', function() {
          const form = document.getElementById('projectBriefForm');
          if (form) {
              form.addEventListener('submit', async (e) => {
                  e.preventDefault(); 
                  const submitButton = document.getElementById('submitBriefButton');
                  submitButton.textContent = 'Submitting...';
                  submitButton.disabled = true;

                  // ==========================================================
                  // === !!! هذا هو الرابط الصحيح الآن !!! ===
                  // ==========================================================
                  const BRIEF_WEBHOOK_URL = "https://script.google.com/macros/s/AKfycbw6VPYwGdA3UiwaSJRS-6L2qoUzyg3FqFbTqbggErKrFp0UwWMcfXcDuVK-pa7LE_cU/exec"; 
                  
                  const BRIEF_SECRET = "MY_BRIEF_FORM_SECRET_987"; 
                  
                  // ==========================================================

                  // === !!! تم حذف الشرط الخاطئ بنجاح !!! ===
                  
                  const formData = new FormData(form);
                  const payload = new URLSearchParams(formData);
                  payload.append("secret", BRIEF_SECRET); 

                  try {
                      const response = await fetch(BRIEF_WEBHOOK_URL, {
                          method: 'POST',
                          body: payload,
                          mode: 'cors'
                      });
                      
                      if (!response.ok) {
                          throw new Error(`HTTP error! status: ${response.status}`);
                      }
                      const result = await response.json();
                      if (result.status === 'ok') {
                          form.style.display = 'none';
                          document.getElementById('successMessage').style.display = 'block';
                      } else {
                          throw new Error(result.message || 'Unknown error from script.');
                      }
                  } catch (err) {
                      console.error('OPTILINE Error:', err);
                      alert('Error submitting brief. Please contact support. (Details: ' + err.message + ')');
                      submitButton.textContent = 'Submit Project & Begin';
                      submitButton.disabled = false;
                  }
              });
          }
      });
    </script>
</body>
</html>
